- hosts: ballometer

  remote_user: root
  
  vars_files: 
    - ./secrets.yml

  tasks:

    - name: Set timezone to Europe/Zurich
      timezone:
        name: Europe/Zurich

    - name: Install git
      apt: 
        name: git 
        state: present

    - name: Install pip
      apt: 
        name: python3-pip 
        state: present

    - name: Install numpy
      apt:
        name: python3-numpy
        state: present

    - name: Clone ballometer from github
      tags: clone
      git:
        repo: https://github.com/wipfli/ballometer.git
        version: master
        dest: /root/ballometer

    - name: Run boot/install.py for faster boot
      tags: boot
      command: /usr/bin/python3 /root/ballometer/device/boot/install.py
      args:
        creates: /boot/config.txt.backup

    # reboot required to enable i2c

    - name: Run sensors/bmp/install.py
      tags: bmp
      command: /usr/bin/python3 /root/ballometer/device/sensors/bmp/install.py

    - name: Run sensors/sht/install.py
      tags: sht
      command: /usr/bin/python3 /root/ballometer/device/sensors/sht/install.py

    - name: Run sensors/tsl/install.py
      tags: tsl
      command: /usr/bin/python3 /root/ballometer/device/sensors/tsl/install.py

    - name: Install ffmpeg for sensors/mic
      tags: mic
      apt:
        name: ffmpeg
        state: present
      

    
      

